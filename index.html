<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>AI Face Battle</title>

  <!-- Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-DJ73ZJSSHG"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){ dataLayer.push(arguments); }
    gtag('js', new Date());
    gtag('config', 'G-DJ73ZJSSHG');
  </script>

  <!-- âœ… Amplitude v2 + Session Replay -->
  <script src="https://cdn.amplitude.com/script/8c8d9e3d7080e5bfd91a608b6f703256.js"></script>
  <script>
    window.amplitude.add(window.sessionReplay.plugin({
      sampleRate: 1
    }));

    window.amplitude.init('8c8d9e3d7080e5bfd91a608b6f703256', {
      fetchRemoteConfig: true,
      autocapture: true
    });

    // Track page load
    window.amplitude.track('page_loaded');
  </script>

  <link rel="stylesheet" href="style.css" />
  <script defer>
    // === JS CODE ===
    let nickname = '';

    // Event Listener fÃ¼r Nickname speichern
    function saveNickname() {
      const input = document.getElementById("nicknameInput");
      nickname = input.value.trim();
      if (nickname !== "") {
        document.getElementById("nicknameOverlay").style.display = "none";
        document.getElementById("welcomeText").textContent = `Welcome, ${nickname}!`;
        window.amplitude.setUserId(nickname);
        window.amplitude.track("nickname_entered", { nickname });
      }
    }

    // Vorschau-Funktion fÃ¼r Bild
    function previewImage(inputId, previewId, playerLabel) {
      const input = document.getElementById(inputId);
      const preview = document.getElementById(previewId);
      input.addEventListener("change", () => {
        const file = input.files[0];
        if (file) {
          const reader = new FileReader();
          reader.onload = () => {
            preview.src = reader.result;
            preview.style.display = "block";
            checkFiles();
            window.amplitude.track("image_uploaded", { player: playerLabel });
          };
          reader.readAsDataURL(file);
        }
      });
    }

    // Beide Bilder vorhanden?
    function checkFiles() {
      const file1 = document.getElementById("playerOneInput").files.length > 0;
      const file2 = document.getElementById("playerTwoInput").files.length > 0;
      document.getElementById("battleBtn").disabled = !(file1 && file2);
    }

    // Battle starten
    window.addEventListener("DOMContentLoaded", () => {
      previewImage("playerOneInput", "playerOnePreview", "Player 1");
      previewImage("playerTwoInput", "playerTwoPreview", "Player 2");

      document.getElementById("battleBtn").addEventListener("click", () => {
        const result = Math.random() < 0.5 ? "Player 1 wins!" : "Player 2 wins!";
        document.getElementById("result").textContent = result;
        window.amplitude.track("battle_started", { winner: result });
      });

      // Datenschutz Overlay
      document.getElementById("openPrivacyBtn").onclick = () => {
        document.getElementById("privacyOverlay").style.display = "block";
      };
      document.getElementById("closePrivacyBtn").onclick = () => {
        document.getElementById("privacyOverlay").style.display = "none";
      };
    });
  </script>
</head>
<body>
  <div class="container">
    <h1>ðŸ§  AI Face Battle</h1>

    <!-- Upload section -->
    <div class="upload-section">
      <div class="upload-box">
        <h3>Picture 1</h3>
        <input type="file" accept="image/*" id="playerOneInput" />
        <img id="playerOnePreview" class="preview" style="display:none;" />
      </div>
      <div class="upload-box">
        <h3>Picture 2</h3>
        <input type="file" accept="image/*" id="playerTwoInput" />
        <img id="playerTwoPreview" class="preview" style="display:none;" />
      </div>
    </div>

    <!-- Battle button -->
    <button id="battleBtn" disabled>Battle starten</button>

    <!-- Ergebnis -->
    <div id="result"></div>

    <!-- Nickname Overlay -->
    <div id="nicknameOverlay" class="overlay">
      <div class="nickname-box">
        <h2>Choose your nickname</h2>
        <input type="text" id="nicknameInput" placeholder="Enter nickname..." />
        <button onclick="saveNickname()">Start</button>
      </div>
    </div>

    <!-- Willkommen -->
    <div id="welcomeText" class="welcome-text"></div>

    <!-- Werbung -->
    <div class="ad-banner">
      <p><a href="mailto:llaaccessorieess@gmail.com" style="color: white;">Your ad could be here.</a></p>
    </div>

    <!-- Datenschutz -->
    <button id="openPrivacyBtn" class="privacy-btn">Privacy Policy</button>
    <div id="privacyOverlay" class="privacy-overlay" style="display:none;">
      <div class="privacy-content">
        <button id="closePrivacyBtn" class="close-btn">&times;</button>
        <h2>Privacy Policy of AI Face Battle</h2>
        <p>This app uses Amplitude and Google Analytics to understand usage.</p>
      </div>
    </div>
  </div>
</body>
</html>
